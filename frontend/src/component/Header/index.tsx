import { Link, Navigate, useLocation  } from "react-router-dom";
import Navigation from "../Navigation";
import styles from "./header.module.scss";
import { useSelector } from "react-redux";
import { logout, selectIsAuth, userData } from "../../redux/slices/auth";
import { RootState, useAppDispatch } from "../../redux/store";
import { Heart, LogIn, ShoppingCart, UserRoundPlus } from "lucide-react";
import { useEffect, useState } from "react";
import { fetchAllBasket } from "../../redux/slices/basket";
import SearchBox from "../Search";
import { fetchAllFavorites } from "../../redux/slices/favorites";
import { motion } from 'framer-motion';

const navigation = [
  { lebel: "Home", link: "/" },
  { lebel: "About", link: "/about" },
  { lebel: "Favorites", link: "/favorites" },
  { lebel: "Basket", link: "/basket" }
];

const Header = () => {
  const location  = useLocation();
  const [isScrolled, setIsScrolled] = useState(false);
  const isAuth = useSelector(selectIsAuth);
  const user = useSelector(userData); // name 
  const dispatch = useAppDispatch();
  const basket = useSelector((state: RootState) => state.basket.data);
  const favorites = useSelector((state: RootState) => state.favorites.data);
  const auth = useSelector((state: RootState) => state.auth.data);


  const onClickLogout = () => {
    if (window.confirm("Are you sure you want to log out?")) {
      dispatch(logout());
      dispatch(fetchAllBasket())
      dispatch(fetchAllFavorites())
      window.localStorage.removeItem("token");
      <Navigate to="/" />
    }
  };

  
    const handleScroll = () => {
        if (window.scrollY > 55) {
            setIsScrolled(true);
        } else {
            setIsScrolled(false);
        }
    };

    useEffect(() => {
        window.addEventListener('scroll', handleScroll);
        return () => {
            window.removeEventListener('scroll', handleScroll);
        };
    }, []);


  


  return (
    <header className={`${styles.header} ${isScrolled ? styles.active : ''}`}>
      <div className="container">
        <div className={styles.wrapper}>
          <Link className={styles.link_logo} to="/">
          <svg className={styles.logo} width="87" height="48" viewBox="0 0 87 48" fill="none" xmlns="http://www.w3.org/2000/svg">
            <motion.path d="M20.8632 21.3305C23.0001 21.3305 24.7323 19.5545 24.7323 17.3638C24.7323 15.1731 23.0001 13.3972 20.8632 13.3972C18.7264 13.3972 16.9941 15.1731 16.9941 17.3638C16.9941 19.5545 18.7264 21.3305 20.8632 21.3305Z" stroke="white" strokeWidth="0.731399" strokeMiterlimit="10"/>
            <motion.path d="M23.9589 9.27218C26.0958 9.27218 27.828 7.49626 27.828 5.30555C27.828 3.11485 26.0958 1.33893 23.9589 1.33893C21.8221 1.33893 20.0898 3.11485 20.0898 5.30555C20.0898 7.49626 21.8221 9.27218 23.9589 9.27218Z" stroke="white" strokeWidth="0.731399" strokeMiterlimit="10"/>
            <motion.path d="M24.1086 5.74202C24.1396 5.73996 24.1698 5.73128 24.1971 5.71656C24.2245 5.70184 24.2483 5.68142 24.2671 5.65669C24.6474 5.13252 24.1647 4.97648 24.1647 4.97648L16.6874 5.57379C16.6516 5.5784 16.6153 5.57423 16.5815 5.56164C16.5477 5.54904 16.5175 5.52841 16.4935 5.50152C16.4695 5.47463 16.4524 5.44229 16.4437 5.40731C16.435 5.37232 16.435 5.33574 16.4436 5.30074C16.5756 4.67817 16.8043 4.08011 17.1213 3.52831C17.1598 3.45813 17.2164 3.39958 17.2852 3.3588C17.3541 3.31801 17.4326 3.29649 17.5126 3.29649C17.5927 3.29649 17.6712 3.31801 17.74 3.3588C17.8089 3.39958 17.8655 3.45813 17.9039 3.52831L17.9015 4.14269C17.8989 4.18455 17.9091 4.22621 17.9307 4.26215C17.9729 4.32651 18.0297 4.37998 18.0965 4.41818C18.1282 4.43464 18.1633 4.44315 18.199 4.44295C18.2347 4.44275 18.2698 4.43387 18.3012 4.41706C18.3327 4.40025 18.3596 4.37602 18.3795 4.34648C18.3995 4.31694 18.412 4.28298 18.4159 4.24752C18.4744 3.75992 18.489 2.6677 17.47 2.62382C16.0949 2.55555 15.7366 5.1569 15.6512 6.11503C15.647 6.1602 15.6525 6.20574 15.6673 6.24862C15.6821 6.2915 15.7059 6.33074 15.737 6.36372C15.7681 6.39671 15.8059 6.42268 15.8479 6.43991C15.8899 6.45715 15.935 6.46524 15.9804 6.46366H17.1018C17.1327 6.46385 17.1632 6.47048 17.1914 6.48313C17.2195 6.49577 17.2447 6.51416 17.2654 6.5371C17.286 6.56005 17.3017 6.58705 17.3113 6.61639C17.3209 6.64572 17.3243 6.67674 17.3212 6.70746L16.7971 12.349C16.793 12.4019 16.7696 12.4514 16.7314 12.4883C16.6932 12.5251 16.6429 12.5467 16.5898 12.5489L15.0198 12.6416C14.9864 12.6432 14.9532 12.6373 14.9224 12.6242C14.8917 12.6112 14.8643 12.5915 14.8423 12.5664C14.8203 12.5413 14.8042 12.5116 14.7952 12.4794C14.7863 12.4473 14.7847 12.4135 14.7906 12.3807C14.845 12.1099 14.8776 11.8351 14.8881 11.5591C14.8881 11.2811 14.6443 11.1788 14.5176 11.1007C14.5002 11.0891 14.4803 11.0819 14.4595 11.0798C14.4388 11.0777 14.4178 11.0808 14.3985 11.0888C14.3792 11.0967 14.3622 11.1093 14.3489 11.1254C14.3357 11.1416 14.3266 11.1607 14.3225 11.1812L13.7008 14.1531C13.6928 14.1879 13.6935 14.2241 13.7029 14.2586C13.7123 14.293 13.73 14.3246 13.7545 14.3506C13.8276 14.4257 13.9255 14.4716 14.03 14.4798C14.0793 14.4841 14.1286 14.4719 14.1701 14.4449C14.2117 14.418 14.243 14.3779 14.2591 14.3311L14.5151 13.5997C14.5285 13.5597 14.553 13.5244 14.5859 13.4981C14.6187 13.4717 14.6585 13.4554 14.7004 13.451L16.5679 13.2657C16.6022 13.2621 16.6368 13.2666 16.669 13.2789C16.7012 13.2912 16.73 13.3109 16.7532 13.3364L20.7515 17.7248C20.7722 17.7476 20.7974 17.766 20.8255 17.7786C20.8536 17.7911 20.884 17.7977 20.9149 17.7979H21.066C21.1125 17.7982 21.1578 17.7837 21.1955 17.7565C21.2331 17.7293 21.2612 17.6909 21.2757 17.6468L23.1724 12.0247C23.1845 11.989 23.1873 11.9507 23.1804 11.9136C23.1736 11.8765 23.1574 11.8418 23.1334 11.8126L18.745 6.54656C18.725 6.52381 18.71 6.49702 18.7012 6.468C18.6924 6.43898 18.6898 6.4084 18.6938 6.37833V6.32714C18.6999 6.27652 18.7235 6.22962 18.7604 6.19447C18.7973 6.15932 18.8453 6.13813 18.8962 6.13453L24.1086 5.74202ZM22.1363 13.0146L20.9173 16.3571C20.904 16.3925 20.8819 16.424 20.8531 16.4485C20.8242 16.473 20.7896 16.4897 20.7524 16.4971C20.7153 16.5044 20.6769 16.5021 20.6409 16.4904C20.6049 16.4787 20.5725 16.458 20.5467 16.4302L17.8479 13.5046C17.821 13.475 17.8026 13.4387 17.7947 13.3995C17.7868 13.3604 17.7896 13.3198 17.8028 13.2821C17.8161 13.2443 17.8392 13.2109 17.8699 13.1853C17.9006 13.1597 17.9376 13.1428 17.9771 13.1365L21.8779 12.5075C21.9084 12.5044 21.9392 12.5077 21.9684 12.5172C21.9975 12.5267 22.0244 12.5421 22.0473 12.5625C22.0702 12.5829 22.0887 12.6078 22.1015 12.6357C22.1143 12.6636 22.1211 12.6938 22.1217 12.7244V12.9365C22.1318 12.9613 22.1367 12.9878 22.1363 13.0146ZM21.756 11.6761L17.7698 12.3051C17.737 12.3086 17.7038 12.3046 17.6726 12.2936C17.6415 12.2826 17.6132 12.2647 17.5898 12.2413C17.5664 12.218 17.5486 12.1897 17.5376 12.1585C17.5265 12.1274 17.5226 12.0942 17.526 12.0613L18.0136 7.42911C18.0214 7.39019 18.0395 7.35408 18.066 7.32453C18.0926 7.29499 18.1265 7.2731 18.1644 7.26115C18.2022 7.24919 18.2426 7.24761 18.2813 7.25657C18.3199 7.26553 18.3555 7.2847 18.3842 7.31209L21.8876 11.3128C21.9132 11.3427 21.9304 11.3788 21.9375 11.4174C21.9446 11.4561 21.9412 11.4959 21.9278 11.5329C21.9144 11.5699 21.8915 11.6026 21.8613 11.6277C21.8311 11.6529 21.7947 11.6696 21.756 11.6761Z" fill="white" stroke="white" strokeWidth="0.2438" strokeMiterlimit="10"/>
            <motion.path
             animate={{scale: 1.2}}
             transition={{
               delay: 2,
               repeat: Infinity,
               repeatType: "reverse",
               repeatDelay: 1,
               duration: 1,
             }}
             
            d="M65.6308 40.2972L67.3106 35.8307L63.5 33.0465H68.3736L69.9314 28.6216L71.2016 33.127H75.8704L71.9379 35.7503L73.1277 40.2972L69.6852 37.7153" fill="#F57520"/>
            <path d="M45.5352 47.7628H50.4266L64.0335 0.627502H59.1421L45.5352 47.7628Z" fill="white"/>
            <path fillRule="evenodd" clipRule="evenodd" d="M52.7383 47.7628L54.2502 43.0493H71.4145L71.7135 43.0495C72.1615 43.05 72.5882 43.0505 72.9986 43.0403C75.29 42.9169 77.3833 41.6646 78.9995 40.0182C80.6744 38.3121 81.6131 36.0157 81.6134 33.6235C81.6135 31.2156 80.6631 28.9051 78.9693 27.1955C78.1052 26.3232 77.094 25.9124 75.9914 25.7165C75.2809 25.6217 74.5645 25.5653 73.8648 25.5419C73.5559 25.5356 73.2432 25.5335 72.9276 25.5314C72.8257 25.5307 72.7235 25.53 72.6211 25.5292H58.8748L60.2088 21.2603H66.9678C68.1738 21.2603 68.8877 21.2729 69.5087 21.2839C70.5363 21.3021 71.3097 21.3158 73.6379 21.2603C74.8619 21.2312 75.6672 21.1925 76.3827 20.9992C77.54 20.5659 78.6006 19.8822 79.4828 18.9832C81.0516 17.3844 81.9309 15.2324 81.9312 12.9907C81.9313 10.7342 81.0694 8.27717 79.4828 6.67505C77.8965 5.07327 75.7531 4.82592 73.5007 4.80743H65.1002L66.0785 0.627511H72.126C72.6095 0.627511 72.9971 0.622948 73.3334 0.61899C74.4817 0.605474 75.0309 0.59901 76.7506 0.805378C76.989 0.833986 77.2073 0.877997 77.4097 0.935744C79.4346 1.29055 81.2992 2.03294 82.8138 3.56234C85.2684 6.04111 86.6069 9.49953 86.6228 12.9907C86.6076 16.4597 85.2409 19.7856 82.8138 22.2604C82.5035 22.5768 82.1776 22.8528 81.838 23.0938C82.0669 23.2688 82.2899 23.4645 82.5066 23.6832C85.1271 26.3283 86.605 29.8981 86.622 33.6235C86.6057 37.3253 85.1467 40.8745 82.5556 43.5154C80.8927 45.2102 78.8475 46.4084 76.6185 47.0711C75.3662 47.51 73.9359 47.7628 72.3039 47.7628H52.7383Z" fill="white"/>
            <path d="M0.888672 0.627258H5.69114L17.1637 40.381L15.385 47.7626L0.888672 0.627258Z" fill="white"/>
            <path d="M17.2539 47.7627H21.9674L31.9281 9.1651L43.3117 47.7627L45.624 40.2033L33.7068 0.62738H29.2601L17.2539 47.7627Z" fill="white"/>
          </svg>

            {/* <img className={styles.logo} src="../images/logo.svg" alt="Logo" /> */}
          </Link>
          <div className={styles.inner}>
            <Navigation navigation={navigation} classNameNav="header-nav" />
            
            {
              location.pathname  === '/' && <SearchBox /> 
            }
          
            {isAuth ? (
              <>
                <button
                  className={styles.exit}
                  onClick={onClickLogout}
                  type="button"
                >
                  {auth?.avatarUrl != '' ?
                    <img className={styles.smallimg} src={`${import.meta.env.VITE_API_BASE_URL}${auth?.avatarUrl}`}alt={user} />
                    :
                    <img className={styles.smallimg} src={`${import.meta.env.VITE_API_BASE_URL}/uploads/d-person.png`} alt="Person" />
                  }
                  {user}
                </button>
              </>
            ) : (
              <>
                <Link className={styles.login} to="./login">
                  <LogIn />
                </Link>
                <Link className={styles.login} to="./registration">
                  <UserRoundPlus />
                </Link>
              </>
            )}
             <Link to="/favorites" className={styles.heart}>
              <Heart />
              <span>{favorites.length}</span>
             </Link>
            <Link to="/basket" className={styles.card}>
                <ShoppingCart />
                <span>{basket.length}</span>
            </Link>
          </div>
        </div>
      </div>
    </header>
  );
};

export default Header;
